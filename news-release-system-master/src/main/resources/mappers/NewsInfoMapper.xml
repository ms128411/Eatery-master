<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.togogo.dao.NewsInfoDao">

    <resultMap id="BaseResultMap" type="net.togogo.domain.NewsInfo" >
        <id column="newsID" property="newsID"  javaType="int" />
        <result column="title" property="title" javaType="String" />
        <result column="content" property="content" javaType="String" />
        <result column="date" property="date" javaType="Date" />
        <result column="authorID" property="authorID" javaType="int" />
        <result column="newsTypeID" property="newsTypeID" javaType="int" />
        <association  property="userName" column="authorID"  javaType="String" select="selectauthor"/>
        <association  property="newsType" column="newsTypeID"  javaType="String" select="selectnewsType"/>
    </resultMap>

    <select id="selectauthor" resultType="String" parameterType="Integer">
  	select userName from user
  	where userID = #{authorID}
  </select>
    <select id="selectnewsType" resultType="String" parameterType="Integer">
  	select newsType from type
  	where TypeID = #{newsTypeID}
  </select>

    <select id="getAllNews" resultMap="BaseResultMap" >
        select *
        from newsinfo
    </select>
    <select id="searchNews" resultMap="BaseResultMap" >
        SELECT newsinfo.* FROM newsinfo,TYPE,USER WHERE typeid = newstypeid AND authorID = userid
        <if test="title!=null">
            and title like CONCAT('%',#{title},'%')
        </if>
        <if test="username!=null">
            and username = #{username}
        </if>
        <if test="newsType!=null">
            and newsType = #{newsType}
        </if>
    </select>

    <delete parameterType="list" id="deleteNews">
        delete from newsinfo where newsID in
        <foreach   open="("  separator="," close=")"   item="id" collection="list">#{id} </foreach>
    </delete>

    <insert id="addNews" >
        insert into newsinfo(photoUrl,title,authorID,newsTypeID,content)
        value(#{param1},#{param2},#{param3},#{param4},#{param5})
    </insert>

    <update id="alterNews">
        update newsinfo  set photoUrl=#{param2} ,title=#{param3},newsTypeID=#{param4},content=#{param5} where newsID=#{param1}
    </update>
    <!--    <select id="getAllNews" resultType="net.togogo.domain.NewsInfo" >-->
<!--        select * from newsInfo-->

<!--    </select>-->
</mapper>